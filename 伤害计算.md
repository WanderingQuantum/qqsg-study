# 伤害计算

## 破甲与减破

破甲与减破是对攻击目标的防御值的改变。QQ三国的战斗系统中存在多种破甲与减破数值。

定义**普通减破**为奥义护体之神、子女藤甲、坚韧之灵和120级技能减破的减破效果。

定义**韧性减破**为角色韧性带来的减破效果。

定义**夫妻减破**为15级及以上夫妻触发协助防御时的减破效果。

定义**破甲/减破百分比**为某种破甲/减破效果所增减的防御百分比。

定义**破甲/减破上限**为某种破甲/减破效果最大能增减的防御值。几乎所有破甲/减破效果都有破甲/减破上限，且物防和法防的破甲/减破上限可能不一样。

定义**破甲/减破值**为某种破甲/减破效果所增减的防御值。

破甲与减破的计算规则为：当目标有破甲与减破效果时，首先对每一种破甲效果计算破甲值
$$破甲值=\min((总防御-元神防御-八阵图防御)*破甲百分比*(1-普通减破百分比之和),破甲上限)$$
$$总破甲值=\sum_{不同破甲效果}破甲值$$
然后对韧性减破计算减破值
$$韧性减破值=\min((总防御-元神防御-八阵图防御)*韧性减破百分比,韧性减破上限)$$
再计算夫妻减破值（若有夫妻协助防御状态）
$$夫妻减破值=\min((总防御-元神防御-八阵图防御)*夫妻减破百分比*(1-普通减破百分比之和),夫妻减破上限)$$
最后得到目标经破甲与减破之后的防御值
$$防御=原防御-(总破甲值-韧性减破值-夫妻减破值)$$

常见破甲效果的数值设定见[这里](常见破甲数据表.md)。

韧性减破的数值设定见[这里](韧性减破数据表.md)。

夫妻减破的数值设定见[这里](夫妻减破数据表.md)。

常见破甲效果中，虎虎生威与破军之气的破甲不能叠加，覆盖情况视破军之气的等级而定；天狼爪与八阵图青龙破甲不能叠加，覆盖情况视两者等级而定；YY100技能破甲与元神破甲不能叠加，元神破甲状态会覆盖YY100技能破甲状态。

[这里][破甲减破计算器]是一个计算破甲减破效果的小工具。

[破甲减破计算器]: http://124.222.71.158/apps/实用计算器/破甲减破计算器

## 治疗量

治疗指任意形式的血量回复，分普通治疗、百分比治疗、固定治疗与吸血四类。

普通治疗指XS治疗技能和子女清晖洒、广寒力的治疗。百分比治疗指按最大生命值的一定百分比进行回复的治疗，包括YX心法、复苏之灵、关羽忠心不二回血、桂魄泉、长生灵兽的复苏、万物复苏、枯木逢春以及120技能回血等等。固定治疗指按固定生命值进行回复的治疗，包括某些再生状态、使用红药等等。吸血指根据攻击伤害的一定百分比进行回复的治疗，包括武器高吸、元神嗜血、奥义吸血、子女借势、灵兽化雨、经络图谱吸血效果、YX45技能、XS120技能吸血效果等等。

普通治疗的治疗量可看作一种特殊的伤害，其计算公式为
$$基础治疗量=0.5*(攻方智力-45)*(1+攻方法攻/24)*技能系数+技能攻击力$$
$$治疗量=基础治疗量*(1+攻方治疗量加成+目标受治疗量加成)*(1-目标受治疗量降低)+额外固定治疗量$$

注意，对子女而言，计算治疗量时，公式中的$攻方智力=子女面板智力+30$。

XS治疗技能的技能系数与0级技能攻击力见[这里](XS治疗技能技能系统与技能攻击力表.md)。子女清晖洒和广寒力的技能系数与技能攻击力见[子女主动技能数据表](子女主动技能数据表.md)。

攻方治疗量加成的来源见下表。

| 系统 | 治疗量加成来源 |
| :----: | :---- |
| 灵魄系统 | 光明之灵 |
| 元神系统 | 马超风扇，陆逊浩然，大乔春风 |
| 奥义系统 | 医圣加持，调养绵绵 |
| 子女系统 | 结丹 |
| 灵兽八阵图系统 | 治愈属性，向善变异，扶风，高级扶风，灵犀磅礴，八阵图玄武特技 |
| 经络系统 | 鹿奔4层，灵鹿1层，白鹿3层 |

目标受治疗量加成的来源见下表。

| 系统 | 受治疗量加成来源 |
| :----: | :---- |
| 灵魄系统 | 赐福之灵 |
| 元神系统 | 大乔国色 |
| 奥义系统 | 妙手之愈 |
| 子女系统 | 良方 |
| 其他 | 青梅状态，某些boss的技能等 |

目标受治疗量降低的来源见下表。

| 系统 | 受治疗量降低来源 |
| :----: | :---- |
| 灵魄系统 | 减治疗灵性 |
| 灵兽八阵图系统 | 灵咒 |
| 角色技能 | YX20，JS130，XS140 |
| 其他 | 某些boss的技能等 |

额外固定治疗量的来源见下表。

| 系统 | 额外固定治疗量来源 |
| :----: | :---- |
| 灵魄系统 | 天赐之灵 |

百分比治疗、固定治疗和吸血的基础治疗量可由相应的描述直接得到，而最终治疗量不受攻方治疗量加成和目标受治疗量加成的影响，很多情况下受目标受治疗量降低的影响，即
$$治疗量=基础治疗量*(1-目标受治疗量降低)$$
但也有不少例外，如YX心法的持续回复、复苏之灵和吸血不受目标受治疗量降低的影响。
